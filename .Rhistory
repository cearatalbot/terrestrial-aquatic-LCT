scale_fill_manual(values=mycols, expression("a"[w]))+
geom_density()+borderTheme0.5+
labs(x=expression('LCT'~(g~C~m^-2~yr^-1)), y=expression('Density'))+
scale_x_continuous(limits=c(0,125), breaks=seq(0, 125, 25), expand=c(0.004,0))+
scale_y_continuous(limits=c(0, 0.025), breaks=seq(0, 0.025, 0.005), expand=c(0.008, 0))+
annotate("text", x=8, y=0.0235, label="D.", size=4.5)
#for aw
aw_wide$trait_f<-as.factor(aw_wide$trait)
aw_wide<-aw_wide[Aw_wide$Precip!=25,]
bp<-ggplot(aw_wide, aes(x=SumLdoc, fill=trait_f, group=trait_f))+
scale_fill_manual(values=mycols, expression("a"[w]))+
geom_density()+borderTheme0.5+
labs(x=expression('LCT'~(g~C~m^-2~yr^-1)), y=expression('Density'))+
scale_x_continuous(limits=c(0,125), breaks=seq(0, 125, 25), expand=c(0.004,0))+
scale_y_continuous(limits=c(0, 0.025), breaks=seq(0, 0.025, 0.005), expand=c(0.008, 0))+
annotate("text", x=8, y=0.0235, label="D.", size=4.5)
bp
ggsave(filename = "KwueDensity_NewS.png", plot=bp, width = 3.5, height = 2.5, units= "in", device='png', dpi=320)
bp<-ggplot(Kwue_wide, aes(x=SumLdoc, fill=trait_f, group=trait_f))+
scale_fill_manual(values=mycols, expression("K"[wue]))+
geom_density()+borderTheme0.5+
labs(x=expression('LCT-DOC'~(g~C~m^-2~yr^-1)), y=expression('Density'))+
scale_x_continuous(limits=c(0,125), breaks=seq(0, 125, 25), expand=c(0.004,0))+
scale_y_continuous(limits=c(0, 0.025), breaks=seq(0, 0.025, 0.005), expand=c(0.008, 0))+
annotate("text", x=8, y=0.0235, label="A.", size=4.5)
bp
ggsave(filename = "KwueDensity_NewS.png", plot=bp, width = 3.5, height = 2.5, units= "in", device='png', dpi=320)
#for Amax
Amax_wide$trait_f<-as.factor(Amax_wide$trait)
Amax_wide<-Amax_wide[Amax_wide$Precip!=25,]
bp<-ggplot(Amax_wide, aes(x=SumLdoc, fill=trait_f, group=trait_f))+
scale_fill_manual(values=mycols, expression("A"[max]))+
geom_density()+borderTheme0.5+
labs(x=expression('LCT-DOC'~(g~C~m^-2~yr^-1)), y=expression('Density'))+
scale_x_continuous(limits=c(0,125), breaks=seq(0, 125, 25), expand=c(0.004,0))+
scale_y_continuous(limits=c(0, 0.025), breaks=seq(0, 0.025, 0.005), expand=c(0.008, 0))+
annotate("text", x=8, y=0.0235, label="B.", size=4.5)
bp
ggsave(filename = "AmaxDensity_NewS.png", plot=bp, width = 3.5, height = 2.5, units= "in", device='png', dpi=320)
#for Topt
Topt_wide$trait_f<-as.factor(Topt_wide$trait)
Topt_wide<-Topt_wide[Topt_wide$Precip!=25,]
bp<-ggplot(Topt_wide, aes(x=SumLdoc, fill=trait_f, group=trait_f))+
scale_fill_manual(values=mycols, expression("T"[opt]))+
geom_density()+borderTheme0.5+
labs(x=expression('LCT'~(g~C~m^-2~yr^-1)), y=expression('Density'))+
scale_x_continuous(limits=c(0,125), breaks=seq(0, 125, 25), expand=c(0.004,0))+
scale_y_continuous(limits=c(0, 0.025), breaks=seq(0, 0.025, 0.005), expand=c(0.008, 0))+
annotate("text", x=8, y=0.0235, label="C.", size=4.5)
bp
ggsave(filename = "ToptDensity_NewS.png", plot=bp, width = 3.5, height = 2.5, units= "in", device='png', dpi=320)
#for aw
aw_wide$trait_f<-as.factor(aw_wide$trait)
aw_wide<-aw_wide[Aw_wide$Precip!=25,]
aw_wide<-aw_wide[aw_wide$Precip!=25,]
bp<-ggplot(aw_wide, aes(x=SumLdoc, fill=trait_f, group=trait_f))+
scale_fill_manual(values=mycols, expression("a"[w]))+
geom_density()+borderTheme0.5+
labs(x=expression('LCT'~(g~C~m^-2~yr^-1)), y=expression('Density'))+
scale_x_continuous(limits=c(0,125), breaks=seq(0, 125, 25), expand=c(0.004,0))+
scale_y_continuous(limits=c(0, 0.025), breaks=seq(0, 0.025, 0.005), expand=c(0.008, 0))+
annotate("text", x=8, y=0.0235, label="D.", size=4.5)
bp
bp<-ggplot(aw_wide, aes(x=SumLdoc, fill=trait_f, group=trait_f))+
scale_fill_manual(values=mycols, expression("a"[w]))+
geom_density()+borderTheme0.5+
labs(x=expression('LCT-DOC'~(g~C~m^-2~yr^-1)), y=expression('Density'))+
scale_x_continuous(limits=c(0,125), breaks=seq(0, 125, 25), expand=c(0.004,0))+
scale_y_continuous(limits=c(0, 0.025), breaks=seq(0, 0.025, 0.005), expand=c(0.008, 0))+
annotate("text", x=8, y=0.0235, label="D.", size=4.5)
bp
ggsave(filename = "AwDensity_NewS.png", plot=bp, width = 3.5, height = 2.5, units= "in", device='png', dpi=320)
##########Analyze output and comparison plots#############
#####################read in files made earlier in script#####
library(ggplot2)
library(reshape2)
RegionsOut<-read.csv("Validation/storedRegions.csv", stringsAsFactors=F)
dfPFT<-read.csv("Validation/regionsPFT.csv", stringsAsFactors=F)#write out PFT to keep
m2Region<-read.csv("Validation/regionsArea.csv", stringsAsFactors=F)#read in areas
runoff<-read.csv("Validation/regionsRunoff.csv", stringsAsFactors=F)#read in areas
ListRegions<-c("01", "02", "03W", "03S", "03N","04", "05", "06",
"07", "08", "09", "10L", "10U", "11", "12", "13",
"14", "15", "16", "17", "18")
pftNam<-c("EG", "DE", "GR", "SH")
#Annual Summary calculation
sumRegions<-data.frame(matrix(ncol=6, nrow=0))
colnames(sumRegions)<-c("pft", "Variable", "Value", "Tmax", "Precip", "Region")
for(x in 1:21){
subRegion<-RegionsOut[RegionsOut$Region==paste("Region",ListRegions[x],sep=""),]
pftSum1<-data.frame(matrix(ncol=6, nrow=0))
colnames(pftSum1)<-c("pft", "Variable", "Value", "Tmax", "Precip")
for(i in 1:4){
pftSum<-data.frame(matrix(ncol=5, nrow=37))
colnames(pftSum)<-c("pft", "Variable", "Value", "Tmax", "Precip")
subPFT<-subRegion[subRegion$PFT==pftNam[i],]
pftSum[,1]<-pftNam[i]
pftSum[,2:3]<-summaryTAM(df=subPFT)
pftSum[,4]<-subRegion$tmaxGrads[1]
pftSum[,5]<-subRegion$pptGrads[1]
pftSum1<-rbind(pftSum1, pftSum)
}#end i loop
pftSum1$Region<-paste("Region", ListRegions[x], sep="")
sumRegions<-rbind(sumRegions, pftSum1)
}#end x loop
#Source functions
source("Functions/TAM_MSVersion.R") #model code
source("Functions/summaryTAM_MSVersion.R") #summary function
source("Functions/findInitials_MSVersion.R") #initial conditions finder
#Annual Summary calculation
sumRegions<-data.frame(matrix(ncol=6, nrow=0))
colnames(sumRegions)<-c("pft", "Variable", "Value", "Tmax", "Precip", "Region")
for(x in 1:21){
subRegion<-RegionsOut[RegionsOut$Region==paste("Region",ListRegions[x],sep=""),]
pftSum1<-data.frame(matrix(ncol=6, nrow=0))
colnames(pftSum1)<-c("pft", "Variable", "Value", "Tmax", "Precip")
for(i in 1:4){
pftSum<-data.frame(matrix(ncol=5, nrow=37))
colnames(pftSum)<-c("pft", "Variable", "Value", "Tmax", "Precip")
subPFT<-subRegion[subRegion$PFT==pftNam[i],]
pftSum[,1]<-pftNam[i]
pftSum[,2:3]<-summaryTAM(df=subPFT)
pftSum[,4]<-subRegion$tmaxGrads[1]
pftSum[,5]<-subRegion$pptGrads[1]
pftSum1<-rbind(pftSum1, pftSum)
}#end i loop
pftSum1$Region<-paste("Region", ListRegions[x], sep="")
sumRegions<-rbind(sumRegions, pftSum1)
}#end x loop
sumRegions$Value<-as.numeric(sumRegions$Value)
data_wide <- dcast(sumRegions, pft + Region + Tmax + Precip ~ Variable, value.var = "Value", fun.aggregate = mean)
#make LCT 0 if unrealistic neg NPP/Cw/Cr is neg
for(i in 1:nrow(data_wide)){
if(data_wide$Cwmin[i] < 0){
data_wide$SumLdoc[i]<-0
} else if (data_wide$NPP < 0){
data_wide$SumLdoc[i]<-0
} else if (data_wide$Cr < 0){
data_wide$SumLdoc[i]<-0
}}
totalRegions<-data.frame(matrix(ncol=5, nrow=21))
colnames(totalRegions)<-c("Region", "EG_gC", "DE_gC", "SH_gC", "GR_gC")
for(x in 1:21){
regional<-data_wide[data_wide$Region==paste("Region", ListRegions[x], sep=""),]
totalRegions$Region[x]<-paste("Region", ListRegions[x], sep="")
totalRegions$DE_gC[x]<-(((dfPFT$dec_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[1])
totalRegions$EG_gC[x]<-(((dfPFT$con_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[2])
totalRegions$GR_gC[x]<-(((dfPFT$gr_weighted[x]+dfPFT$cr_weighted[x])/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[3])
totalRegions$SH_gC[x]<-((dfPFT$sh_weighted[x]/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[4])
}
totalRegions$total<-(totalRegions$EG_gC+totalRegions$DE_gC+totalRegions$SH_gC+totalRegions$GR_gC)/1000000000000 #to TgC
totalR03<-((totalRegions$total[3]*m2Region$m2area[3])+(totalRegions$total[4]*m2Region$m2area[4])+(totalRegions$total[5]*m2Region$m2area[5]))/(m2Region$m2area[3]+m2Region$m2area[4]+m2Region$m2area[5])
totalR10<-((totalRegions$total[13]*m2Region$m2area[13])+(totalRegions$total[14]*m2Region$m2area[14]))/(m2Region$m2area[13]+m2Region$m2area[14])
subTotals<-data.frame(cbind(totalRegions$Region, totalRegions$total))
colnames(subTotals)<-c("Region", "TgC")
subTotals$Region[3]<-"Region03"
subTotals$TgC[3]<-totalR03
subTotals<-subTotals[-4,]
subTotals<-subTotals[-4,]
subTotals$Region[10]<-"Region10"
subTotals$TgC[10]<-totalR10
subTotals<-subTotals[-11,]
ButmanTable<-read.csv("Validation/ButmanTable.csv", stringsAsFactors=F)
ButmanTable$LCT<-ButmanTable$Lake.efflux..Tg.C.yr.1.*.30+ButmanTable$Steam.efflux..Tg.C.yr.1.*.30+(ButmanTable$Total.lateral.flux..TgC.yr.1.)*(ButmanTable$PCT_OC/100)+ButmanTable$Lake.burial..Tg.C.yr.1.
#Hotchkiss et al 2015: ~28% of stream/river emissions are from terrestrial DOC
AllLCT<-data.frame(cbind(subTotals, ButmanTable$LCT))
colnames(AllLCT)<-c("Region", "model", "Butman")
AllLCT$model<-as.numeric(AllLCT$model)
AllLCT$RegNum<-1:nrow(AllLCT)
borderTheme0.5<-theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
panel.background = element_rect(colour = "black", size=1, fill=NA),
strip.background = element_blank(),
panel.spacing = unit(0.3, "lines"), axis.ticks.length = unit(0.2, "lines"),
text = element_text(size = 12),legend.background=element_blank(),
legend.key = element_rect(fill = NA), aspect.ratio = 1)
library(ggrepel)
plot1<-ggplot(data=AllLCT, aes(x=Butman, y=model))+geom_point(size=0.7)+
#geom_text(label=AllLCT$Region)+
scale_x_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
scale_y_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
geom_abline(slope=1, intercept = 0, linetype="dashed", color="grey")+
labs(y=expression('Modeled LCT'~(Tg~C~yr^-1)),x=expression('Literature LCT'~(Tg~C~yr^-1)))+
geom_text(label=AllLCT$RegNum, hjust = -0.1, nudge_x = 0.2,size=2.5)+
annotate("text", x=1, y=11, label= "A.", size=4.5)+
borderTheme0.5
plot1
plot1<-ggplot(data=AllLCT, aes(x=Butman, y=model))+geom_point(size=0.7)+
#geom_text(label=AllLCT$Region)+
scale_x_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
scale_y_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
geom_abline(slope=1, intercept = 0, linetype="dashed", color="grey")+
labs(y=expression('Modeled LCT-DOC'~(Tg~C~yr^-1)),x=expression('Literature LCT'~(Tg~C~yr^-1)))+
geom_text(label=AllLCT$RegNum, hjust = -0.1, nudge_x = 0.2,size=2.5)+
annotate("text", x=1, y=11, label= "A.", size=4.5)+
borderTheme0.5
plot1
#ggsave(filename = "Validation/ButmanPointsLCT.png", plot=plot1, width = 3.5, height = 2.5, units= "in", device='png', dpi=320)
colnames(AllLCT)<-c("Region", "ModelLCT", "ButmanLCT", "RegNum")
ggsave(filename = "Validation/ButmanPointsLCT.png", plot=plot1, width = 3.5, height = 2.5, units= "in", device='png', dpi=320)
plot1<-ggplot(data=AllLCT, aes(x=Butman, y=model))+geom_point(size=0.7)+
#geom_text(label=AllLCT$Region)+
scale_x_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
scale_y_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
geom_abline(slope=1, intercept = 0, linetype="dashed", color="grey")+
labs(y=expression('Modeled LCT-DOC'~(Tg~C~yr^-1)),x=expression('Literature LCT-DOC'~(Tg~C~yr^-1)))+
geom_text(label=AllLCT$RegNum, hjust = -0.1, nudge_x = 0.2,size=2.5)+
annotate("text", x=1, y=11, label= "A.", size=4.5)+
borderTheme0.5
plot1
borderTheme0.5<-theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
panel.background = element_rect(colour = "black", size=1, fill=NA),
strip.background = element_blank(),
panel.spacing = unit(0.3, "lines"), axis.ticks.length = unit(0.2, "lines"),
text = element_text(size = 12),legend.background=element_blank(),
legend.key = element_rect(fill = NA), aspect.ratio = 1)
library(ggrepel)
plot1<-ggplot(data=AllLCT, aes(x=Butman, y=model))+geom_point(size=0.7)+
#geom_text(label=AllLCT$Region)+
scale_x_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
scale_y_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
geom_abline(slope=1, intercept = 0, linetype="dashed", color="grey")+
labs(y=expression('Modeled LCT-DOC'~(Tg~C~yr^-1)),x=expression('Literature LCT-DOC'~(Tg~C~yr^-1)))+
geom_text(label=AllLCT$RegNum, hjust = -0.1, nudge_x = 0.2,size=2.5)+
annotate("text", x=1, y=11, label= "A.", size=4.5)+
borderTheme0.5
plot1
totalRegions<-data.frame(matrix(ncol=5, nrow=21))
colnames(totalRegions)<-c("Region", "EG_gC", "DE_gC", "SH_gC", "GR_gC")
for(x in 1:21){
regional<-data_wide[data_wide$Region==paste("Region", ListRegions[x], sep=""),]
totalRegions$Region[x]<-paste("Region", ListRegions[x], sep="")
totalRegions$DE_gC[x]<-(((dfPFT$dec_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[1])
totalRegions$EG_gC[x]<-(((dfPFT$con_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[2])
totalRegions$GR_gC[x]<-(((dfPFT$gr_weighted[x]+dfPFT$cr_weighted[x])/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[3])
totalRegions$SH_gC[x]<-((dfPFT$sh_weighted[x]/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[4])
}
totalRegions$total<-(totalRegions$EG_gC+totalRegions$DE_gC+totalRegions$SH_gC+totalRegions$GR_gC)/1000000000000 #to TgC
totalR03<-((totalRegions$total[3]*m2Region$m2area[3])+(totalRegions$total[4]*m2Region$m2area[4])+(totalRegions$total[5]*m2Region$m2area[5]))/(m2Region$m2area[3]+m2Region$m2area[4]+m2Region$m2area[5])
totalR10<-((totalRegions$total[13]*m2Region$m2area[13])+(totalRegions$total[14]*m2Region$m2area[14]))/(m2Region$m2area[13]+m2Region$m2area[14])
subTotals<-data.frame(cbind(totalRegions$Region, totalRegions$total))
colnames(subTotals)<-c("Region", "TgC")
subTotals$Region[3]<-"Region03"
subTotals$TgC[3]<-totalR03
subTotals<-subTotals[-4,]
subTotals<-subTotals[-4,]
subTotals$Region[10]<-"Region10"
subTotals$TgC[10]<-totalR10
subTotals<-subTotals[-11,]
ButmanTable<-read.csv("Validation/ButmanTable.csv", stringsAsFactors=F)
ButmanTable$LCT<-ButmanTable$Lake.efflux..Tg.C.yr.1.*.30+ButmanTable$Steam.efflux..Tg.C.yr.1.*.30+(ButmanTable$Total.lateral.flux..TgC.yr.1.)*(ButmanTable$PCT_OC/100)+ButmanTable$Lake.burial..Tg.C.yr.1.
#Hotchkiss et al 2015: ~28% of stream/river emissions are from terrestrial DOC
AllLCT<-data.frame(cbind(subTotals, ButmanTable$LCT))
colnames(AllLCT)<-c("Region", "model", "Butman")
AllLCT$model<-as.numeric(AllLCT$model)
AllLCT$RegNum<-1:nrow(AllLCT)
borderTheme0.5<-theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
panel.background = element_rect(colour = "black", size=1, fill=NA),
strip.background = element_blank(),
panel.spacing = unit(0.3, "lines"), axis.ticks.length = unit(0.2, "lines"),
text = element_text(size = 12),legend.background=element_blank(),
legend.key = element_rect(fill = NA), aspect.ratio = 1)
library(ggrepel)
plot1<-ggplot(data=AllLCT, aes(x=Butman, y=model))+geom_point(size=0.7)+
#geom_text(label=AllLCT$Region)+
scale_x_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
scale_y_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
geom_abline(slope=1, intercept = 0, linetype="dashed", color="grey")+
labs(y=expression('Modeled LCT-DOC'~(Tg~C~yr^-1)),x=expression('Literature LCT-DOC'~(Tg~C~yr^-1)))+
geom_text(label=AllLCT$RegNum, hjust = -0.1, nudge_x = 0.2,size=2.5)+
annotate("text", x=1, y=11, label= "A.", size=4.5)+
borderTheme0.5
plot1
ggsave(filename = "Validation/ButmanPointsLCT.png", plot=plot1, width = 3.7, height = 2.7, units= "in", device='png', dpi=320)
ggsave(filename = "Validation/ButmanPointsLCT.png", plot=plot1, width = 3.8, height = 2.8, units= "in", device='png', dpi=320)
totalRegionsLCTareal<-data.frame(matrix(ncol=5, nrow=21))
colnames(totalRegionsLCTareal)<-c("Region", "EG_gC", "DE_gC", "SH_gC", "GR_gC")
for(x in 1:21){
regional<-data_wide[data_wide$Region==paste("Region", ListRegions[x], sep=""),]
totalRegionsLCTareal$Region[x]<-paste("Region", ListRegions[x], sep="")
#area weighted LCT g C m-2 yr-1
totalRegionsLCTareal$DE_gC[x]<-(((dfPFT$dec_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[1])/m2Region$m2area[x]
totalRegionsLCTareal$EG_gC[x]<-(((dfPFT$con_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[2])/m2Region$m2area[x]
totalRegionsLCTareal$GR_gC[x]<-(((dfPFT$gr_weighted[x]+dfPFT$cr_weighted[x])/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[3])/m2Region$m2area[x]
totalRegionsLCTareal$SH_gC[x]<-((dfPFT$sh_weighted[x]/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[4])/m2Region$m2area[x]
}
totalRegionsLCTareal$total<-(totalRegionsLCTareal$EG_gC+totalRegionsLCTareal$DE_gC+totalRegionsLCTareal$SH_gC+totalRegionsLCTareal$GR_gC)
for(i in 1:nrow(totalRegionsLCTareal)){
subdwide<-data_wide[data_wide$Region==totalRegionsLCTareal$Region[i], ]
totalRegionsLCTareal$Precip[i]<-subdwide$Precip[1]
totalRegionsLCTareal$Tmax[i]<-subdwide$Tmax[1]
}
arealplusclim<-data.frame(cbind(totalRegionsLCTareal$Region, totalRegionsLCTareal$total, totalRegionsLCTareal$Precip, totalRegionsLCTareal$Tmax))
colnames(arealplusclim)<-c("Region", "LCT", "Precip", "Tmax")
for(i in 1:nrow(arealplusclim)){
arealplusclim$RegNum[i]<-unlist(strsplit(arealplusclim$Region[i], split="Region"))[2]
}
arealplusclim$Tmax<-as.numeric(arealplusclim$Tmax)
arealplusclim$Precip<-as.numeric(arealplusclim$Precip)
arealplusclim$LCT<-as.numeric(arealplusclim$LCT)
plot3<-ggplot(data=arealplusclim, aes(x=Precip, y=LCT, group=Tmax, colour=Tmax))+
scale_x_continuous(limits=c(25,162), breaks=seq(25, 150, 25), expand=c(0,0))+
scale_y_continuous(limits=c(0,25), breaks=seq(0, 25, 5), expand=c(0,0))+
labs(y=expression('LCT'~(g~C~m^-2~yr^-1)),x=expression('Precipitation'~(cm~yr^-1)))+
scale_color_viridis_c("Temp (C)", option="B", alpha = 0.8, begin = 0, end = 0.9)+
geom_point(size=1)+
geom_text_repel(label=arealplusclim$RegNum,size=2, color="black")+
borderTheme0.5
plot3
plot3<-ggplot(data=arealplusclim, aes(x=Precip, y=LCT, group=Tmax, colour=Tmax))+
scale_x_continuous(limits=c(25,162), breaks=seq(25, 150, 25), expand=c(0,0))+
scale_y_continuous(limits=c(0,25), breaks=seq(0, 25, 5), expand=c(0,0))+
labs(y=expression('LCT-DOC'~(g~C~m^-2~yr^-1)),x=expression('Precipitation'~(cm~yr^-1)))+
scale_color_viridis_c("Temp (C)", option="B", alpha = 0.8, begin = 0, end = 0.9)+
geom_point(size=1)+
geom_text_repel(label=arealplusclim$RegNum,size=2, color="black")+
borderTheme0.5
plot3
ggsave(filename = "Validation/ArealLCT.png", plot=plot3, width = 3.6, height = 2.6, units= "in", device='png', dpi=320)
Kwue_wide<-read.csv("ModelExperiments/Kwue_wide.csv")
Amax_wide<-read.csv("ModelExperiments/Amax_wide.csv")
aw_wide<-read.csv("ModelExperiments/aw_wide.csv")
Topt_wide<-read.csv("ModelExperiments/Topt_wide.csv")
###density plots
borderTheme0.5<-theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
panel.background = element_rect(colour = "black", size=1.5, fill=NA),
strip.background = element_blank(),
panel.spacing = unit(0.3, "lines"), axis.ticks.length = unit(0.2, "lines"),
text = element_text(size = 14),legend.background=element_blank(),
legend.key = element_rect(fill = NA),)
mycols<-viridis(6, alpha = 0.6, end = 1, option = "D")
#for Topt
Topt_wide$trait_f<-as.factor(Topt_wide$trait)
Topt_wide<-Topt_wide[Topt_wide$Precip!=25,]
bp<-ggplot(Topt_wide, aes(x=SumLdoc, fill=trait_f, group=trait_f))+
scale_fill_manual(values=mycols, expression("T"[opt]))+
geom_density()+borderTheme0.5+
labs(x=expression('LCT-DOC'~(g~C~m^-2~yr^-1)), y=expression('Density'))+
scale_x_continuous(limits=c(0,125), breaks=seq(0, 125, 25), expand=c(0.004,0))+
scale_y_continuous(limits=c(0, 0.025), breaks=seq(0, 0.025, 0.005), expand=c(0.008, 0))+
annotate("text", x=8, y=0.0235, label="C.", size=4.5)
bp
ggsave(filename = "ToptDensity_NewS.png", plot=bp, width = 3.5, height = 2.5, units= "in", device='png', dpi=320)
AllLCT<-cbind(subTotalsNPP, ButmanTable$NPP, ButmanTable$NPPsd)
colnames(AllLCT)<-c("Region", "model", "Butman", "Butmansd")
AllLCT$model<-as.numeric(AllLCT$model)
##########Analyze output and comparison plots#############
#####################read in files made earlier in script#####
library(ggplot2)
library(reshape2)
RegionsOut<-read.csv("Validation/storedRegions.csv", stringsAsFactors=F)
dfPFT<-read.csv("Validation/regionsPFT.csv", stringsAsFactors=F)#write out PFT to keep
m2Region<-read.csv("Validation/regionsArea.csv", stringsAsFactors=F)#read in areas
runoff<-read.csv("Validation/regionsRunoff.csv", stringsAsFactors=F)#read in areas
ListRegions<-c("01", "02", "03W", "03S", "03N","04", "05", "06",
"07", "08", "09", "10L", "10U", "11", "12", "13",
"14", "15", "16", "17", "18")
pftNam<-c("EG", "DE", "GR", "SH")
#Annual Summary calculation
sumRegions<-data.frame(matrix(ncol=6, nrow=0))
colnames(sumRegions)<-c("pft", "Variable", "Value", "Tmax", "Precip", "Region")
for(x in 1:21){
subRegion<-RegionsOut[RegionsOut$Region==paste("Region",ListRegions[x],sep=""),]
pftSum1<-data.frame(matrix(ncol=6, nrow=0))
colnames(pftSum1)<-c("pft", "Variable", "Value", "Tmax", "Precip")
for(i in 1:4){
pftSum<-data.frame(matrix(ncol=5, nrow=37))
colnames(pftSum)<-c("pft", "Variable", "Value", "Tmax", "Precip")
subPFT<-subRegion[subRegion$PFT==pftNam[i],]
pftSum[,1]<-pftNam[i]
pftSum[,2:3]<-summaryTAM(df=subPFT)
pftSum[,4]<-subRegion$tmaxGrads[1]
pftSum[,5]<-subRegion$pptGrads[1]
pftSum1<-rbind(pftSum1, pftSum)
}#end i loop
pftSum1$Region<-paste("Region", ListRegions[x], sep="")
sumRegions<-rbind(sumRegions, pftSum1)
}#end x loop
#Source functions
source("Functions/TAM_MSVersion.R") #model code
source("Functions/summaryTAM_MSVersion.R") #summary function
source("Functions/findInitials_MSVersion.R") #initial conditions finder
##########Analyze output and comparison plots#############
#####################read in files made earlier in script#####
library(ggplot2)
library(reshape2)
RegionsOut<-read.csv("Validation/storedRegions.csv", stringsAsFactors=F)
dfPFT<-read.csv("Validation/regionsPFT.csv", stringsAsFactors=F)#write out PFT to keep
m2Region<-read.csv("Validation/regionsArea.csv", stringsAsFactors=F)#read in areas
runoff<-read.csv("Validation/regionsRunoff.csv", stringsAsFactors=F)#read in areas
ListRegions<-c("01", "02", "03W", "03S", "03N","04", "05", "06",
"07", "08", "09", "10L", "10U", "11", "12", "13",
"14", "15", "16", "17", "18")
pftNam<-c("EG", "DE", "GR", "SH")
#Annual Summary calculation
sumRegions<-data.frame(matrix(ncol=6, nrow=0))
colnames(sumRegions)<-c("pft", "Variable", "Value", "Tmax", "Precip", "Region")
for(x in 1:21){
subRegion<-RegionsOut[RegionsOut$Region==paste("Region",ListRegions[x],sep=""),]
pftSum1<-data.frame(matrix(ncol=6, nrow=0))
colnames(pftSum1)<-c("pft", "Variable", "Value", "Tmax", "Precip")
for(i in 1:4){
pftSum<-data.frame(matrix(ncol=5, nrow=37))
colnames(pftSum)<-c("pft", "Variable", "Value", "Tmax", "Precip")
subPFT<-subRegion[subRegion$PFT==pftNam[i],]
pftSum[,1]<-pftNam[i]
pftSum[,2:3]<-summaryTAM(df=subPFT)
pftSum[,4]<-subRegion$tmaxGrads[1]
pftSum[,5]<-subRegion$pptGrads[1]
pftSum1<-rbind(pftSum1, pftSum)
}#end i loop
pftSum1$Region<-paste("Region", ListRegions[x], sep="")
sumRegions<-rbind(sumRegions, pftSum1)
}#end x loop
sumRegions$Value<-as.numeric(sumRegions$Value)
data_wide <- dcast(sumRegions, pft + Region + Tmax + Precip ~ Variable, value.var = "Value", fun.aggregate = mean)
#make LCT 0 if unrealistic neg NPP/Cw/Cr is neg
for(i in 1:nrow(data_wide)){
if(data_wide$Cwmin[i] < 0){
data_wide$SumLdoc[i]<-0
} else if (data_wide$NPP < 0){
data_wide$SumLdoc[i]<-0
} else if (data_wide$Cr < 0){
data_wide$SumLdoc[i]<-0
}}
totalRegions<-data.frame(matrix(ncol=5, nrow=21))
colnames(totalRegions)<-c("Region", "EG_gC", "DE_gC", "SH_gC", "GR_gC")
for(x in 1:21){
regional<-data_wide[data_wide$Region==paste("Region", ListRegions[x], sep=""),]
totalRegions$Region[x]<-paste("Region", ListRegions[x], sep="")
totalRegions$DE_gC[x]<-(((dfPFT$dec_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[1])
totalRegions$EG_gC[x]<-(((dfPFT$con_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[2])
totalRegions$GR_gC[x]<-(((dfPFT$gr_weighted[x]+dfPFT$cr_weighted[x])/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[3])
totalRegions$SH_gC[x]<-((dfPFT$sh_weighted[x]/100)*m2Region$m2area[x])*as.numeric(regional$SumLdoc[4])
}
totalRegions$total<-(totalRegions$EG_gC+totalRegions$DE_gC+totalRegions$SH_gC+totalRegions$GR_gC)/1000000000000 #to TgC
totalR03<-((totalRegions$total[3]*m2Region$m2area[3])+(totalRegions$total[4]*m2Region$m2area[4])+(totalRegions$total[5]*m2Region$m2area[5]))/(m2Region$m2area[3]+m2Region$m2area[4]+m2Region$m2area[5])
totalR10<-((totalRegions$total[13]*m2Region$m2area[13])+(totalRegions$total[14]*m2Region$m2area[14]))/(m2Region$m2area[13]+m2Region$m2area[14])
subTotals<-data.frame(cbind(totalRegions$Region, totalRegions$total))
colnames(subTotals)<-c("Region", "TgC")
subTotals$Region[3]<-"Region03"
subTotals$TgC[3]<-totalR03
subTotals<-subTotals[-4,]
subTotals<-subTotals[-4,]
subTotals$Region[10]<-"Region10"
subTotals$TgC[10]<-totalR10
subTotals<-subTotals[-11,]
ButmanTable<-read.csv("Validation/ButmanTable.csv", stringsAsFactors=F)
ButmanTable$LCT<-ButmanTable$Lake.efflux..Tg.C.yr.1.*.30+ButmanTable$Steam.efflux..Tg.C.yr.1.*.30+(ButmanTable$Total.lateral.flux..TgC.yr.1.)*(ButmanTable$PCT_OC/100)+ButmanTable$Lake.burial..Tg.C.yr.1.
#Hotchkiss et al 2015: ~28% of stream/river emissions are from terrestrial DOC
AllLCT<-data.frame(cbind(subTotals, ButmanTable$LCT))
colnames(AllLCT)<-c("Region", "model", "Butman")
AllLCT$model<-as.numeric(AllLCT$model)
AllLCT$RegNum<-1:nrow(AllLCT)
borderTheme0.5<-theme(panel.grid.major = element_blank(),panel.grid.minor = element_blank(),
panel.background = element_rect(colour = "black", size=1, fill=NA),
strip.background = element_blank(),
panel.spacing = unit(0.3, "lines"), axis.ticks.length = unit(0.2, "lines"),
text = element_text(size = 12),legend.background=element_blank(),
legend.key = element_rect(fill = NA), aspect.ratio = 1)
library(ggrepel)
plot1<-ggplot(data=AllLCT, aes(x=Butman, y=model))+geom_point(size=0.7)+
#geom_text(label=AllLCT$Region)+
scale_x_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
scale_y_continuous(limits=c(0,12), breaks=seq(0, 12, 3), expand=c(0,0))+
geom_abline(slope=1, intercept = 0, linetype="dashed", color="grey")+
labs(y=expression('Modeled LCT-DOC'~(Tg~C~yr^-1)),x=expression('Literature LCT-DOC'~(Tg~C~yr^-1)))+
geom_text(label=AllLCT$RegNum, hjust = -0.1, nudge_x = 0.2,size=2.5)+
annotate("text", x=1, y=11, label= "A.", size=4.5)+
borderTheme0.5
plot1
#ggsave(filename = "Validation/ButmanPointsLCT.png", plot=plot1, width = 3.8, height = 2.8, units= "in", device='png', dpi=320)
colnames(AllLCT)<-c("Region", "ModelLCT", "ButmanLCT", "RegNum")
###NPP###
totalRegionsNPP<-data.frame(matrix(ncol=6, nrow=21)) #empty to store calculations
colnames(totalRegionsNPP)<-c("Region", "EG_gC", "DE_gC", "SH_gC", "GR_gC", "total")
for(x in 1:21){
regional<-data_wide[data_wide$Region==paste("Region", ListRegions[x], sep=""),]
totalRegionsNPP$Region[x]<-paste("Region", ListRegions[x], sep="")
#total NPP in g C yr-1 for each HUC
totalRegionsNPP$DE_gC[x]<-(((dfPFT$dec_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])*as.numeric(regional$NPP[1])
totalRegionsNPP$EG_gC[x]<-(((dfPFT$con_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])*as.numeric(regional$NPP[2])
totalRegionsNPP$GR_gC[x]<-(((dfPFT$gr_weighted[x]+dfPFT$cr_weighted[x])/100)*m2Region$m2area[x])*as.numeric(regional$NPP[3])
totalRegionsNPP$SH_gC[x]<-((dfPFT$sh_weighted[x]/100)*m2Region$m2area[x])*as.numeric(regional$NPP[4])
#to g C m-2 yr-1
totalRegionsNPP$total[x]<-(totalRegionsNPP$EG_gC[x]+totalRegionsNPP$DE_gC[x]+totalRegionsNPP$SH_gC[x]+totalRegionsNPP$GR_gC[x])/((((dfPFT$dec_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])+((((dfPFT$con_weighted[x]+(0.5*dfPFT$mx_weighted[x]))/100)*m2Region$m2area[x])+(((dfPFT$gr_weighted[x]+dfPFT$cr_weighted[x])/100)*m2Region$m2area[x])+((dfPFT$sh_weighted[x]/100)*m2Region$m2area[x])))
}
#calculate NPP for modified HUCs (to match Butman et al. 2016)
totalR03<-(((totalRegionsNPP$total[3]*m2Region$m2area[3])+(totalRegionsNPP$total[4]*m2Region$m2area[4])+(totalRegionsNPP$total[5]*m2Region$m2area[5]))/(m2Region$m2area[3]+m2Region$m2area[4]+m2Region$m2area[5]))
totalR10<-(((totalRegionsNPP$total[13]*m2Region$m2area[13])+(totalRegionsNPP$total[14]*m2Region$m2area[14]))/(m2Region$m2area[13]+m2Region$m2area[14]))
subTotalsNPP<-data.frame(cbind(totalRegionsNPP$Region, totalRegionsNPP$total))
colnames(subTotalsNPP)<-c("Region", "TgC")
subTotalsNPP$Region[3]<-"Region03"
subTotalsNPP$TgC[3]<-totalR03
subTotalsNPP<-subTotalsNPP[-4,]
subTotalsNPP<-subTotalsNPP[-4,]
subTotalsNPP$Region[10]<-"Region10"
subTotalsNPP$TgC[10]<-totalR10
subTotalsNPP<-subTotalsNPP[-11,]
AllLCT<-cbind(subTotalsNPP, ButmanTable$NPP, ButmanTable$NPPsd)
colnames(AllLCT)<-c("Region", "model", "Butman", "Butmansd")
AllLCT$model<-as.numeric(AllLCT$model)
AllLCT$RegNum<-1:nrow(AllLCT)
plot2<-ggplot(data=AllLCT, aes(x=Butman, y=model))+
scale_x_continuous(limits=c(0,1300), breaks=seq(0, 1200, 300), expand=c(0,0))+
scale_y_continuous(limits=c(0,1300), breaks=seq(0, 1200, 300), expand=c(0,0))+geom_abline(slope=1, intercept = 0, linetype="dashed", color="grey")+
labs(y=expression('Modeled NPP'~(g~C~m^-2~yr^-1)),x=expression('Literature NPP'~(g~C~m^-2~yr^-1)))+
geom_pointrange(aes(xmin=Butman-Butmansd, xmax=Butman+Butmansd), size=0.1, color="black")+
geom_point(size=0.7, color="black")+
geom_text(label=AllLCT$RegNum, hjust = -0.5, nudge_x = 0.3,size=2.5)+
annotate("text", x=100, y=1200, label= "B.", size=4.5)+
borderTheme0.5
plot2
ggsave(filename = "Validation/ButmanPointsNPP.png", plot=plot2, width = 3.6, height = 2.6, units= "in", device='png', dpi=320)
